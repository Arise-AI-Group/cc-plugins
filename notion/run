#!/bin/bash
# Activate virtual environment and run Python script
# Resolve symlinks to get the actual script location
SCRIPT_PATH="$0"
if [ -L "$SCRIPT_PATH" ]; then
    SCRIPT_PATH="$(cd "$(dirname "$0")" && readlink "$SCRIPT_PATH")"
    SCRIPT_PATH="$(cd "$(dirname "$0")" && cd "$(dirname "$SCRIPT_PATH")" && pwd)/$(basename "$SCRIPT_PATH")"
fi
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"

if [ ! -d "$SCRIPT_DIR/.venv" ]; then
    echo "Virtual environment not found. Run ./setup.sh first."
    exit 1
fi

source "$SCRIPT_DIR/.venv/bin/activate"
cd "$SCRIPT_DIR"

# Convert path like tool/script.py to module: tool.script
if [[ "$1" == *.py ]]; then
    module="${1%.py}"
    module="${module//\//.}"
    shift
    python3 -m "$module" "$@"
else
    python3 "$@"
fi
